# SERVIZ Experiments
This repository contains the ```bash``` run scripts to reproduce the experiments contained in the SC'22 ```pap427```. There are two directories, representing
experiments before the rebuttal (C1-to-C10) and experiments performed after the rebuttal (C11-C30). Experiments belonging to different configurations are "bundled" together to prevent the wastage of computing resources on Theta's ```default``` queue which requires a minimum of 128-node jobs to be submitted. 

**Note**: You may have to modify the values of environment variables before running the scripts (depending on your directory structure), so _please read the README_ file in each of these directories and go through the all the relevant ```*.sh``` files before running these experiments. 

## How to Perform the Cost-Savings Calculation:
The fundamental premise for this work is that a higher degree of cost-savings can be achieved for 
scientific HPC visualization if the visualization is carried out in a **_shared, in transit manner
represented by the SERVIZ architecture, in comparison to the default inline method_**. Inline
methods form the baseline for comparison. Here, we are interested in calculating the savings
in the total cost of execution in terms of **_CPU node-seconds_**. 

For example, if there are ```N``` identical MPI simulations, each running for ```S``` seconds 
on ```n``` compute nodes performing **_inline_** visualization, then the total CPU node-seconds
for this execution, denoted by ```C``` is ```N*n*S```. ```C``` forms the baseline value for our calculation.

If these ```N``` identifical MPI simulations
are coupled in an in transit fashion to a single, shared SERVIZ instance (running on a dedicated node),
and the entire workflow executes for ```S'``` seconds, then the total CPU node-seconds for the SERVIZ
execution, denoted by ```C'``` is ```(N*n+1)*S'```. Note the extra ```+1``` in the calculation is due
to the additional compute node required to run SERVIZ. What we want to demonstrate here is that **```C' < C```**.
Therefore, the cost-savings presented in ```Tables V, VII, and VIII``` are calculated using the formula: 
```((C - C')/C)*100```.

The execution time of each MPI simulation (when coupled with SERVIZ) can found by tailing the ```STDOUT``` file in each configuration 
sub-directory generated by the bash run scripts. For convenience, the baseline value, ```C```, can be calculated using
```Table III``` for the AMR-WIND simulation and ```Table VI``` for the Kripke simulation. Alternatively,
if you would like to verify the baseline value by yourself, you can do so by setting ```export AMS_USE_LOCAL_ASCENT=1```
for the execution. This would direct the simulation to use the local inline Ascent library for performing
the visualization.

**Note 1**: The total execution time ```T``` = ```Tsim``` + ```Tinline```. We need to use this total
execution time ```T``` in the baseline calculation and _not just_ ```Tinline```.

**Note 2**: The ```Tinline``` data in ```Table III``` and ```Table VI``` assume a visualization frequency of 1,
meaning, visualization is carried out during every simulation iteration. When calculating the baseline
for experiments involving visualization at lower frequencies (1/4, 1/8, etc), we need to multiply ```Tinline```
by the visualization frequency and add this number to the simulation baseline ```Tsim```. 


